# Getting started

### Prerequisites

To be able to use Exekutor, you need the following

- **Ruby 2.6** or higher
- **Rails 6** or higher
- **PostgreSQL 9.5** or higher

## Installation

Add it to your bundle by executing:

```sh
$ bundle add exekutor
```

Or install it yourself by executing:

```sh
$ gem install exekutor
```

## Set up

### Migrations

Create the migration and initializer by running

```sh
$ rails g exekutor:install
```

and run the migration with

```sh
$ rails db:migrate
``` 

This will create the necessary tables for Exekutor to work and creates a few database functions and triggers.

> ### Please note
> The generated database functions and triggers do not end up in your `schema.rb` file.
> There are a few things to get around this:
> - Install the [Fx](https://rubygems.org/gems/fx) gem. If this gem is loaded when generating the migration, the
    >   generator will automatically generate a migration which uses `Fx`.
> - Change your schema output to
    SQL: [Rails guide](https://edgeguides.rubyonrails.org/active_record_migrations.html#types-of-schema-dumps)
> - Create the functions and triggers in the seeds file.
>
> If left unattended, the functions and triggers will not be created when loading the schema file in your database!

### Rails configuration

Configure Exekutor as your active job adapter by setting in in your environment file:

```ruby
config.active_job.queue_adapter = :good_job
```

You can run this from `config/application.rb` to configure all your environments, or run it from
`config/environments/%{RAILS_ENV}.rb` (eg. `production.rb`) to configure it for a single environment.

### Exekutor configuration

After running the `exekutor:install` generator, an initializer will be created in the `config/initializers` directory.
You can configure global configuration options in this file, see the [README](README.md) for a description of all the
possible options.

#### YAML configuration

It is possible to override the global Exekutor options with a YAML file. When starting an Exekutor worker from the CLI,
the worker reads `config/exekutor.yml` and loads the configuration over the configuration from the initializer. An 
example YAML file can be generated by running `rails g exekutor:configuration`.

## Performing jobs

After setting up Exekutor, it's time to start performing jobs. Restart your rails environment and queue a job by running

```ruby
MyJob.perform_later
```

This adds your job to the `exekutor_jobs` table, ready to be performed by an Exekutor worker. The worker can be started
by running

```sh
$ bundle exec exekutor -v start
```

This starts a verbose worker in the foreground which will perform the job ðŸŽ‰

See the [README](README.md) for more information about the workers and the command line options.
